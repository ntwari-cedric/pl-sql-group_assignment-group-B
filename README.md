# pl-sql-group_assignment-group-B

## PHS2 ‚Äì PL/SQL Assignment (AUCA System) 

---

## üë• Group Members

1. **Ntambara Shema Chrispin** ‚Äì 28280  
2. **Munyanturire Kaliza Liesse** ‚Äì 28410  
3. **Himba Aimee Mireille** ‚Äì 28220  
4. **Ntwari Cedric** ‚Äì 28228  
5. **Singizwa Boncoeur** ‚Äì 28308 
6. **Irembere Olivier** ‚Äì 28392  
7. **Uwase Sonia Umutoni** ‚Äì 28352

# üìò **AUCA System Access Control ‚Äì Database Trigger Module**
AUCA)**.
The system enforces strict operational rules and logs violations for audit and security purposes.

---

## üìå **Project Overview**

AUCA requires that students and system users can only access academic systems:

* **Monday‚ÄìFriday**
* **Between 08:00 AM and 05:00 PM**
* **No access allowed during Sabbath (Saturday & Sunday)**

This repository provides a **modular database solution** using:

* ‚úî **One function** that encapsulates the business rules
* ‚úî **Two triggers** (as required by the specification)

  * Trigger 1 ‚Üí **Blocks unauthorized operations**
  * Trigger 2 ‚Üí **Logs all violations for auditing**

This ensures **real-time enforcement** and **traceability** of all unauthorized access attempts.

---

## üõ† **System Architecture**

### **1. Tables**

The system consists of three core tables:

| Table             | Purpose                                       |
| ----------------- | --------------------------------------------- |
| `student`         | Stores student identity (ID + name)           |
| `student_records` | Operational table students attempt to modify  |
| `access_log`      | Stores all blocked actions for audit tracking |

### **Student Table**
```sql
CREATE TABLE student (
    student_id INT PRIMARY KEY,
    student_name VARCHAR(100)
);
```

![student table](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/student%20table.png?raw=true)
### **Student Records Table**

```sql
CREATE TABLE student_records (
    record_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    student_id NUMBER,
    details VARCHAR2(255),
    CONSTRAINT fk_student FOREIGN KEY (student_id) REFERENCES student(student_id)
);
```

![record](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/table%20record%20creation.png?raw=true)
### **Access Log Table**


```sql
CREATE TABLE access_log (
    log_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    student_id NUMBER,
    student_name VARCHAR2(100),
    attempted_action VARCHAR2(255),
    attempt_time DATE,
    message VARCHAR2(255)
);
```

![access table](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/table%20accces.png?raw=true)

## üîß **Modular Access-Control Function**

Instead of embedding business rules inside triggers, we implement a **dedicated function**, improving maintainability and respecting good database design practices.

```sql
CREATE OR REPLACE FUNCTION fn_is_access_allowed
RETURN NUMBER
IS
    v_day  VARCHAR2(10);
    v_hour NUMBER;
BEGIN
    -- Get current day and hour
    v_day  := TO_CHAR(SYSDATE, 'DY', 'NLS_DATE_LANGUAGE=ENGLISH');
    v_hour := TO_NUMBER(TO_CHAR(SYSDATE, 'HH24'));

    -- Rule 1: Block weekends (Sat/Sun)
    IF v_day IN ('SAT', 'SUN') THEN
        RETURN 0;
    END IF;

    -- Rule 2: Block outside 8AM‚Äì5PM
    IF v_hour < 8 OR v_hour >= 17 THEN
        RETURN 0;
    END IF;

    RETURN 1; -- Allowed
END;
```

![function](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/function%20hour.png?raw=true)
## ‚ö†Ô∏è **Trigger 1: Enforcement (Blocks Unauthorized Access)**

This trigger prevents students from inserting records outside allowed days or hours.

```sql
CREATE OR REPLACE TRIGGER trg_enforce_access
BEFORE INSERT ON student_records
FOR EACH ROW
BEGIN
    IF fn_is_access_allowed() = 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'Access blocked: System is unavailable at this time.');
    END IF;
END;
```

![trigger 1](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/trigger%201%20creation.png?raw=true)


## üìù **Trigger 2: Audit Logging (Records Violations)**

This trigger logs **who attempted**, **when**, and **what action** was blocked.

```sql
CREATE OR REPLACE TRIGGER trg_log_access_violation
BEFORE INSERT ON student_records
FOR EACH ROW
BEGIN
    IF fn_is_access_allowed() = 0 THEN
        INSERT INTO access_log
            (student_id, student_name, attempted_action, attempt_time, message)
        VALUES
            (:NEW.student_id,
             (SELECT s.student_name 
                FROM student s 
               WHERE s.student_id = :NEW.student_id),
             'INSERT into student_records',
             SYSDATE,
             'Unauthorized attempt outside allowed days/hours');
    END IF;
END;
```
![trigger 2](https://github.com/ntwari-cedric/pl-sql-group_assignment-group-B/blob/main/trigger%20cleation.png?raw=true)

## üîí **Security Principles Implemented**

### 1. **Least Privilege Access**

Users can only access the system during designated operational periods.

### 2. **Separation of Enforcement & Logging**

Two-trigger architecture ensures:

* Enforcement trigger blocks unauthorized actions
* Logging trigger records evidence for administrators

### 3. **Modularity**

All business rules are centralized inside a single function, making updates easy.

---

## üìä **Example Log Output**

| student_id | student_name | action | time             | message                                    |
| ---------- | ------------ | ------ | ---------------- | ------------------------------------------ |
| 305        | Jean Claude  | INSERT | 2025-11-21 21:13 | Unauthorized attempt outside allowed hours |

---

## üìò **Conclusion**

This project demonstrates a clean, modular, and professional implementation of AUCA‚Äôs access policy using:

* ‚úî One function
* ‚úî Two triggers
* ‚úî Structured audit logs
* ‚úî Student identity integration



